<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Karol’s 3D‑printed Airports – Interactive Map</title>
  <meta name="description" content="Interactive world map of Karol’s 3D‑printed airports with details and MakerWorld links. Includes continent filter and upcoming airports layer." />

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  <!-- MarkerCluster CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
  
  <style>
    :root { --bg:#0b1020; --panel:#12172b; --text:#e9edf5; --muted:#a6b0cf; --accent:#6aa0ff; }
    html,body{height:100%;margin:0}
    body{background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,"Helvetica Neue",Arial}
    .app{display:grid;grid-template-rows:auto 1fr;height:100%;min-height:100vh}
    header{display:flex;align-items:center;justify-content:space-between;gap:1rem;padding:.9rem 1rem;background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,0));border-bottom:1px solid rgba(255,255,255,.08)}
    header h1{font-size:1.05rem;margin:0;letter-spacing:.2px}
    header .meta{font-size:.9rem;color:var(--muted)}
    .controls{display:flex;gap:.5rem;align-items:center}
    .controls input[type="search"], .controls select{background:var(--panel);color:var(--text);border:1px solid rgba(255,255,255,.1);border-radius:10px;padding:.45rem .7rem}
    .controls input[type="search"]{width:22ch}
    .controls button{background:var(--panel);color:var(--text);border:1px solid rgba(255,255,255,.15);border-radius:10px;padding:.45rem .7rem;cursor:pointer}
    .controls button:hover{border-color:var(--accent)}
    #map{height:100%;width:100%;min-height:80vh}

    .leaflet-popup-content-wrapper{background:var(--panel);color:var(--text);border-radius:12px}
    .leaflet-popup-tip{background:var(--panel)}
    .popup h3{margin:.2rem 0 .4rem;font-size:1rem}
    .popup .sub{color:var(--muted);font-size:.9rem;margin-bottom:.35rem}
    .popup a{color:var(--accent);text-decoration:none}
    .popup a:hover{text-decoration:underline}
    .badge{display:inline-block;padding:.15rem .45rem;border:1px solid rgba(255,255,255,.18);border-radius:999px;font-size:.75rem;color:var(--muted);margin-right:.35rem}
    .footer{position:absolute;right:10px;bottom:12px;background:rgba(18,23,43,.8);color:var(--muted);padding:.35rem .6rem;border-radius:8px;font-size:.8rem;z-index:400}

    .planned-dot{width:18px;height:18px;border-radius:50%;background:#e53935;border:2px solid rgba(255,255,255,.85);box-shadow:0 0 0 2px rgba(229,57,53,.35)}
    .printed-dot{width:18px;height:18px;border-radius:50%;background:#3b82f6;border:2px solid rgba(255,255,255,.85);box-shadow:0 0 0 2px rgba(59,130,246,.35)}
    .legend{background:rgba(18,23,43,.85);color:var(--text);padding:.5rem .7rem;border-radius:8px;font-size:.85rem;line-height:1.2;border:1px solid rgba(255,255,255,.1)}
    .legend-row{display:flex;align-items:center;gap:.5rem;margin:.2rem 0}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Karol’s 3D‑printed Airports</h1>
      <div class="controls">
        <input id="search" type="search" placeholder="Search: City, IATA, ICAO" />
        <select id="continent" aria-label="Filter by continent">
          <option value="all" selected>All continents</option>
          <option value="Africa">Africa</option>
          <option value="Asia">Asia</option>
          <option value="Europe">Europe</option>
          <option value="North America">North America</option>
          <option value="South America">South America</option>
          <option value="Oceania">Oceania</option>
        </select>
        <button id="reset">Reset</button>
      </div>
      <div class="meta">Public map · Leaflet</div>
    </header>
    <div id="map"></div>
    <div class="footer">Tip: Click any marker for details & MakerWorld link</div>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <!-- MarkerCluster JS -->
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

  <script>
    // ====== DATA ======
    const AIRPORTS = [
      { name: 'Adelaide', iata: 'ADL', icao: 'YPAD', city: 'Adelaide', country: 'Australia', lat: -34.9450, lng: 138.5306, makerUrl: '#' },
      { name: 'Orlando', iata: 'MCO', icao: 'KMCO', city: 'Orlando', country: 'USA', lat: 28.4312, lng: -81.3081, makerUrl: '#' },
      { name: 'Farmingdale – Republic', iata: 'FRG', icao: 'KFRG', city: 'Farmingdale, NY', country: 'USA', lat: 40.7288, lng: -73.4134, makerUrl: '#' },
      { name: 'New York – John F. Kennedy', iata: 'JFK', icao: 'KJFK', city: 'New York', country: 'USA', lat: 40.6413, lng: -73.7781, makerUrl: '#' },
      { name: 'Washington Dulles', iata: 'IAD', icao: 'KIAD', city: 'Washington, DC', country: 'USA', lat: 38.9531, lng: -77.4565, makerUrl: '#' },
      { name: 'Brescia Montichiari', iata: 'VBS', icao: 'LIPO', city: 'Brescia', country: 'Italy', lat: 45.4289, lng: 10.3306, makerUrl: '#' },
      { name: 'Seattle–Tacoma', iata: 'SEA', icao: 'KSEA', city: 'Seattle', country: 'USA', lat: 47.4502, lng: -122.3088, makerUrl: '#' },
      { name: 'Los Angeles', iata: 'LAX', icao: 'KLAX', city: 'Los Angeles', country: 'USA', lat: 33.9416, lng: -118.4085, makerUrl: '#' },
      { name: 'Frankfurt Main', iata: 'FRA', icao: 'EDDF', city: 'Frankfurt', country: 'Germany', lat: 50.0379, lng: 8.5622, makerUrl: '#' },
      { name: 'Munich', iata: 'MUC', icao: 'EDDM', city: 'Munich', country: 'Germany', lat: 48.3538, lng: 11.7861, makerUrl: '#' },
      { name: 'San Francisco', iata: 'SFO', icao: 'KSFO', city: 'San Francisco', country: 'USA', lat: 37.6213, lng: -122.3790, makerUrl: '#' },
    ];

    const PLANNED_AIRPORTS = [
      { name: 'Salt Lake City', iata: 'SLC', icao: 'KSLC', city: 'Salt Lake City', country: 'USA', lat: 40.7899, lng: -111.9791, note: 'Coming soon' },
      { name: 'Bangkok – Suvarnabhumi', iata: 'BKK', icao: 'VTBS', city: 'Bangkok', country: 'Thailand', lat: 13.6900, lng: 100.7501, note: 'Coming soon' },
      { name: 'Tokyo – Haneda', iata: 'HND', icao: 'RJTT', city: 'Tokyo', country: 'Japan', lat: 35.5494, lng: 139.7798, note: 'Coming soon' },
      { name: 'Beijing – Daxing', iata: 'PKX', icao: 'ZBAD', city: 'Beijing', country: 'China', lat: 39.5099, lng: 116.4108, note: 'Coming soon' },
      { name: 'Istanbul', iata: 'IST', icao: 'LTFM', city: 'Istanbul', country: 'Turkey', lat: 41.2622, lng: 28.7278, note: 'Coming soon' },
      { name: 'Paris – CDG', iata: 'CDG', icao: 'LFPG', city: 'Paris', country: 'France', lat: 49.0097, lng: 2.5479, note: 'Coming soon' },
      { name: 'Amsterdam – Schiphol', iata: 'AMS', icao: 'EHAM', city: 'Amsterdam', country: 'Netherlands', lat: 52.3105, lng: 4.7683, note: 'Coming soon' },
      { name: 'Hannover', iata: 'HAJ', icao: 'EDDV', city: 'Hanover', country: 'Germany', lat: 52.4611, lng: 9.6850, note: 'Coming soon' },
      { name: 'Barcelona – El Prat', iata: 'BCN', icao: 'LEBL', city: 'Barcelona', country: 'Spain', lat: 41.2971, lng: 2.0785, note: 'Coming soon' },
      { name: 'Zurich', iata: 'ZRH', icao: 'LSZH', city: 'Zurich', country: 'Switzerland', lat: 47.4647, lng: 8.5492, note: 'Coming soon' },
      { name: 'Sydney – Kingsford Smith', iata: 'SYD', icao: 'YSSY', city: 'Sydney', country: 'Australia', lat: -33.9399, lng: 151.1753, note: 'Coming soon' },
      { name: 'Singapore – Changi', iata: 'SIN', icao: 'WSSS', city: 'Singapore', country: 'Singapore', lat: 1.3644, lng: 103.9915, note: 'Coming soon' },
      { name: 'Cincinnati/Northern Kentucky', iata: 'CVG', icao: 'KCVG', city: 'Cincinnati', country: 'USA', lat: 39.0488, lng: -84.6678, note: 'Coming soon' },
      { name: 'Berlin – BER', iata: 'BER', icao: 'EDDB', city: 'Berlin', country: 'Germany', lat: 52.3667, lng: 13.5033, note: 'Coming soon' },
      { name: 'London – Heathrow', iata: 'LHR', icao: 'EGLL', city: 'London', country: 'UK', lat: 51.4700, lng: -0.4543, note: 'Coming soon' },
      { name: 'Dubai – DXB', iata: 'DXB', icao: 'OMDB', city: 'Dubai', country: 'UAE', lat: 25.2532, lng: 55.3657, note: 'Coming soon' },
      { name: 'Doha – Hamad', iata: 'DOH', icao: 'OTHH', city: 'Doha', country: 'Qatar', lat: 25.2731, lng: 51.6081, note: 'Coming soon' },
      { name: 'Malé – Velana', iata: 'MLE', icao: 'VRMM', city: 'Male', country: 'Maldives', lat: 4.1918, lng: 73.5291, note: 'Coming soon' },
      { name: 'Seoul – Incheon', iata: 'ICN', icao: 'RKSI', city: 'Seoul', country: 'South Korea', lat: 37.4602, lng: 126.4407, note: 'Coming soon' },
      { name: 'Honolulu – HNL', iata: 'HNL', icao: 'PHNL', city: 'Honolulu', country: 'USA', lat: 21.3245, lng: -157.9251, note: 'Coming soon' },
      { name: 'Toronto – Pearson', iata: 'YYZ', icao: 'CYYZ', city: 'Toronto', country: 'Canada', lat: 43.6777, lng: -79.6248, note: 'Coming soon' },
    ];

    // ====== MAP SETUP ======
    const map = L.map('map', { worldCopyJump: true });
    const tiles = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    const printedMarkers = L.markerClusterGroup({ showCoverageOnHover: false, spiderfyOnMaxZoom: true });
    const plannedMarkers = L.markerClusterGroup({ showCoverageOnHover: false, spiderfyOnMaxZoom: true });

    function makePlannedIcon(){
      return L.divIcon({ className:'planned-icon', html:'<div class="planned-dot"></div>', iconSize:[18,18], iconAnchor:[9,9] });
    }

    // Continent mapping by country name (fast + simple)
    function getContinent(country){
      const c=(country||'').toLowerCase();
      if(/usa|united states|canada|mexico/.test(c)) return 'North America';
      if(/brazil|argentin|chile|peru|colombi|ecuador|bolivi|uruguay|paraguay/.test(c)) return 'South America';
      if(/germany|france|netherlands|italy|spain|switzerland|austria|united kingdom|uk|turkey|poland|czech|belg|denmark|norway|sweden|finland|portugal|ireland|netherlands|holland/.test(c)) return 'Europe';
      if(/australia|new zealand/.test(c)) return 'Oceania';
      if(/china|japan|korea|singapore|thailand|qatar|united arab emirates|uae|maldives|istanbul|doha|dubai|beijing|tokyo|bangkok|south korea/.test(c)) return 'Asia';
      if(/egypt|kenya|nigeria|south africa|morocco|ghana|ethiopia|tanzania/.test(c)) return 'Africa';
      return 'Other';
    }

    const allLatLngs=[];

    // Printed markers
    AIRPORTS.forEach(ap=>{
      if(typeof ap.lat!=='number'||typeof ap.lng!=='number') return;
      const m=L.marker([ap.lat,ap.lng]);
      const link=ap.makerUrl&&ap.makerUrl!=='#'?`<a href="${ap.makerUrl}" target="_blank" rel="noopener">MakerWorld: Print now →</a>`:`<span class="badge">MakerWorld link coming soon</span>`;
      const popup=`<div class="popup"><h3>${ap.name}</h3><div class="sub">${ap.city}, ${ap.country}</div><div style="margin:.35rem 0 .5rem;"><span class="badge">IATA: ${ap.iata}</span><span class="badge">ICAO: ${ap.icao}</span><span class="badge">Status: printed</span></div>${link}</div>`;
      m.bindPopup(popup);
      m.apData={...ap,status:'printed',continent:getContinent(ap.country)};
      printedMarkers.addLayer(m);
      allLatLngs.push([ap.lat,ap.lng]);
    });

    // Planned markers
    PLANNED_AIRPORTS.forEach(ap=>{
      if(typeof ap.lat!=='number'||typeof ap.lng!=='number') return;
      const m=L.marker([ap.lat,ap.lng],{icon:makePlannedIcon()});
      const note=ap.note?`<div class="sub" style="margin-top:.2rem">${ap.note}</div>`:'';
      const popup=`<div class="popup"><h3>${ap.name}</h3><div class="sub">${ap.city}, ${ap.country}</div><div style="margin:.35rem 0 .5rem;"><span class="badge">IATA: ${ap.iata}</span><span class="badge">ICAO: ${ap.icao}</span><span class="badge">Status: planned</span></div><span class="badge">Coming soon</span>${note}</div>`;
      m.bindPopup(popup);
      m.apData={...ap,status:'planned',continent:getContinent(ap.country)};
      plannedMarkers.addLayer(m);
      allLatLngs.push([ap.lat,ap.lng]);
    });

    map.addLayer(printedMarkers);
    map.addLayer(plannedMarkers);

    // Layers toggle
    L.control.layers({}, { 'Printed': printedMarkers, 'Planned (red)': plannedMarkers }, { collapsed: false }).addTo(map);

    // Fit bounds
    if(allLatLngs.length) map.fitBounds(allLatLngs,{padding:[30,30]}); else map.setView([20,0],2);

    // Legend
    const Legend=L.Control.extend({options:{position:'bottomleft'},onAdd:function(){const div=L.DomUtil.create('div','legend');div.innerHTML=`<div style="font-weight:600;margin-bottom:.3rem;">Legend</div><div class="legend-row"><span class="printed-dot"></span> Printed</div><div class="legend-row"><span class="planned-dot"></span> Planned</div>`;return div;}});
    map.addControl(new Legend());

    // Search + Continent filter
    const searchInput=document.getElementById('search');
    const resetBtn=document.getElementById('reset');
    const continentSel=document.getElementById('continent');

    function rebuildLayersFrom(listPrinted,listPlanned){
      printedMarkers.clearLayers();
      plannedMarkers.clearLayers();
      const bounds=[];

      listPrinted.forEach(ap=>{
        const m=L.marker([ap.lat,ap.lng]);
        const link=ap.makerUrl&&ap.makerUrl!=='#'?`<a href="${ap.makerUrl}" target="_blank" rel="noopener">MakerWorld: Print now →</a>`:`<span class="badge">MakerWorld link coming soon</span>`;
        const popup=`<div class=\"popup\"><h3>${ap.name}</h3><div class=\"sub\">${ap.city}, ${ap.country}</div><div style=\"margin:.35rem 0 .5rem;\"><span class=\"badge\">IATA: ${ap.iata}</span><span class=\"badge\">ICAO: ${ap.icao}</span><span class=\"badge\">Status: printed</span></div>${link}</div>`;
        m.bindPopup(popup);
        printedMarkers.addLayer(m);
        bounds.push([ap.lat,ap.lng]);
      });

      listPlanned.forEach(ap=>{
        const m=L.marker([ap.lat,ap.lng],{icon:makePlannedIcon()});
        const note=ap.note?`<div class=\"sub\" style=\"margin-top:.2rem\">${ap.note}</div>`:'';
        const popup=`<div class=\"popup\"><h3>${ap.name}</h3><div class=\"sub\">${ap.city}, ${ap.country}</div><div style=\"margin:.35rem 0 .5rem;\"><span class=\"badge\">IATA: ${ap.iata}</span><span class=\"badge\">ICAO: ${ap.icao}</span><span class=\"badge\">Status: planned</span></div><span class=\"badge\">Coming soon</span>${note}</div>`;
        m.bindPopup(popup);
        plannedMarkers.addLayer(m);
        bounds.push([ap.lat,ap.lng]);
      });

      if(bounds.length) map.fitBounds(bounds,{padding:[30,30]});
    }

    function applyFilter(term){
      const q=(term||'').trim().toLowerCase();
      const cont=(continentSel.value||'all');
      const bySearch=ap=>`${ap.name} ${ap.city} ${ap.country} ${ap.iata} ${ap.icao}`.toLowerCase().includes(q);
      const byCont=ap=>cont==='all'||getContinent(ap.country)===cont||ap.continent===cont;
      const filteredPrinted=AIRPORTS.filter(ap=>bySearch(ap)&&byCont(ap));
      const filteredPlanned=PLANNED_AIRPORTS.filter(ap=>bySearch(ap)&&byCont(ap));
      rebuildLayersFrom(filteredPrinted,filteredPlanned);
    }

    searchInput.addEventListener('input', e=>applyFilter(e.target.value));
    continentSel.addEventListener('change', ()=>applyFilter(searchInput.value));
    resetBtn.addEventListener('click', ()=>{ searchInput.value=''; continentSel.value='all'; applyFilter(''); });

    // Ensure proper sizing on first paint (mobile/Safari)
    window.addEventListener('load', ()=>{ setTimeout(()=>map.invalidateSize(), 50); });
  </script>
</body>
</html>