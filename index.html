<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Karolâ€™s 3D-Printed Airports â€“ Interactive Map</title>
  <meta name="description" content="Interaktive Weltkarte aller bereits gedruckten FlughÃ¤fen mit Infos und Direktlinks zu MakerWorld." />

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  <!-- MarkerCluster CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
  
  <style>
    :root {
      --bg: #0b1020;
      --panel: #12172b;
      --text: #e9edf5;
      --muted: #a6b0cf;
      --accent: #6aa0ff;
    }
    html, body { height: 100%; margin: 0; }
    body { background: var(--bg); color: var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, 'Helvetica Neue', Arial, 'Apple Color Emoji', 'Segoe UI Emoji'; }
    .app { display: grid; grid-template-rows: auto 1fr; height: 100%; }
    header { display: flex; align-items: center; justify-content: space-between; gap: 1rem; padding: 0.9rem 1rem; background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0)); border-bottom: 1px solid rgba(255,255,255,0.08); }
    header h1 { font-size: 1.05rem; margin: 0; letter-spacing: .2px; }
    header .meta { font-size: .9rem; color: var(--muted); }
    .controls { display: flex; gap: .5rem; align-items: center; }
    .controls input[type="search"] { background: var(--panel); color: var(--text); border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; padding: .45rem .7rem; width: 22ch; }
    .controls button { background: var(--panel); color: var(--text); border: 1px solid rgba(255,255,255,0.15); border-radius: 10px; padding: .45rem .7rem; cursor: pointer; }
    .controls button:hover { border-color: var(--accent); }

    #map { height: 100%; width: 100%; }

    .leaflet-popup-content-wrapper { background: var(--panel); color: var(--text); border-radius: 12px; }
    .leaflet-popup-tip { background: var(--panel); }
    .popup h3 { margin: .2rem 0 .4rem; font-size: 1rem; }
    .popup .sub { color: var(--muted); font-size: .9rem; margin-bottom: .35rem; }
    .popup a { color: var(--accent); text-decoration: none; }
    .popup a:hover { text-decoration: underline; }
    .badge { display: inline-block; padding: .15rem .45rem; border: 1px solid rgba(255,255,255,0.18); border-radius: 999px; font-size: .75rem; color: var(--muted); margin-right: .35rem; }
    .footer { position: absolute; right: 10px; bottom: 12px; background: rgba(18,23,43,0.8); color: var(--muted); padding: .35rem .6rem; border-radius: 8px; font-size: .8rem; z-index: 400; }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Karolâ€™s 3D-Printed Airports â€“ Interactive Map</h1>
      <div class="controls">
        <input id="search" type="search" placeholder="Suche: Stadt, IATA, ICAO" />
        <button id="reset">Reset</button>
      </div>
      <div class="meta">Ã–ffentliche Karte Â· Leaflet Â· ðŸ‡©ðŸ‡ª</div>
    </header>
    <div id="map"></div>
    <div class="footer">Tip: Click on a marker for details & MakerWorld link</div>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <!-- MarkerCluster JS -->
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

  <script>
    // ====== Datensatz: bereits gedruckte FlughÃ¤fen ======
    // FÃ¼lle die makerUrl mit deinem echten MakerWorld-Link.
    // Wenn kein Link existiert, lass es auf "#" stehen.
    const AIRPORTS = [
      { name: 'New York â€“ John F. Kennedy', iata: 'JFK', icao: 'KJFK', city: 'New York', country: 'USA', lat: 40.6413, lng: -73.7781, makerUrl: 'https://makerworld.com/de/models/1637593-new-york-intl-airport-kjfk-jfk#profileId-1730048' },
      { name: 'Washington Dulles', iata: 'IAD', icao: 'KIAD', city: 'Washington, DC', country: 'USA', lat: 38.9531, lng: -77.4565, makerUrl: 'https://makerworld.com/de/models/1571994-washington-intl-airport-kiad-iad#profileId-1653452' },
      { name: 'Brescia Montichiari', iata: 'VBS', icao: 'LIPO', city: 'Brescia', country: 'Italien', lat: 45.4289, lng: 10.3306, makerUrl: 'https://makerworld.com/de/models/1571987-brescia-montichiari-airport-lipo-vbs#profileId-1653442' },
      { name: 'Seattleâ€“Tacoma', iata: 'SEA', icao: 'KSEA', city: 'Seattle', country: 'USA', lat: 47.4502, lng: -122.3088, makerUrl: 'https://makerworld.com/de/models/1499239-seattle-intl-airport-ksea-sea#profileId-1568169' },
      { name: 'Los Angeles', iata: 'LAX', icao: 'KLAX', city: 'Los Angeles', country: 'USA', lat: 33.9416, lng: -118.4085, makerUrl: 'https://makerworld.com/de/models/1499198-los-angeles-intl-airport-klax-lax#profileId-1568122' },
      { name: 'Frankfurt Main', iata: 'FRA', icao: 'EDDF', city: 'Frankfurt', country: 'Deutschland', lat: 50.0379, lng: 8.5622, makerUrl: 'https://makerworld.com/de/models/1499159-frankfurt-intl-airport-eddf-fra#profileId-1568074' },
      { name: 'San Francisco', iata: 'SFO', icao: 'KSFO', city: 'San Francisco', country: 'USA', lat: 37.6213, lng: -122.3790, makerUrl: 'https://makerworld.com/de/models/1437390-san-francisco-intl-airport-ksfo-sfo#profileId-1495606' },
      { name: 'Munich', iata: 'MUC', icao: 'EDDM', city: 'MÃ¼nchen', country: 'Deutschland', lat: 48.3538, lng: 11.7861, makerUrl: 'https://makerworld.com/de/models/1433941-munich-airport-eddm-muc-runway-layout#profileId-1491535' },
      { name: 'Adelaide', iata: 'ADL', icao: 'YPAD', city: 'Adelaide', country: 'Australien', lat: -34.9450, lng: 138.5306, makerUrl: 'https://makerworld.com/de/models/1828920-adelaide-intl-airport-ypad-adl#profileId-1952744' },
      { name: 'Farmingdale â€“ Republic', iata: 'FRG', icao: 'KFRG', city: 'Farmingdale, NY', country: 'USA', lat: 40.7288, lng: -73.4134, makerUrl: 'https://makerworld.com/de/models/1828845-republic-airport-kfrg-frg#profileId-1952656' },
      { name: 'Orlando', iata: 'MCO', icao: 'KMCO', city: 'Orlando', country: 'USA', lat: 28.4312, lng: -81.3081, makerUrl: 'https://makerworld.com/de/models/1828907-orlando-intl-airport-kmco-mco#profileId-1952728' },
    ];

    // ====== Karte initialisieren ======
    const map = L.map('map', { worldCopyJump: true });
    const tiles = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 18,
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> Mitwirkende'
    }).addTo(map);

    // Marker Cluster Gruppe
    const markers = L.markerClusterGroup({ showCoverageOnHover: false, spiderfyOnMaxZoom: true });

    // Icon optional anpassen (hier Standard belassen)

    // Marker hinzufÃ¼gen
    const latlngs = [];
    AIRPORTS.forEach(ap => {
      if (typeof ap.lat !== 'number' || typeof ap.lng !== 'number') return;
      const m = L.marker([ap.lat, ap.lng]);
      const link = ap.makerUrl && ap.makerUrl !== '#' 
        ? `<a href="${ap.makerUrl}" target="_blank" rel="noopener">MakerWorld: Jetzt drucken â†’</a>`
        : `<span class="badge">MakerWorldâ€‘Link folgt</span>`;
      const popup = `
        <div class="popup">
          <h3>${ap.name}</h3>
          <div class="sub">${ap.city}, ${ap.country}</div>
          <div style="margin:.35rem 0 .5rem;">
            <span class="badge">IATA: ${ap.iata}</span>
            <span class="badge">ICAO: ${ap.icao}</span>
          </div>
          ${link}
        </div>`;
      m.bindPopup(popup);
      m.apData = ap; // fÃ¼r Suche
      markers.addLayer(m);
      latlngs.push([ap.lat, ap.lng]);
    });

    map.addLayer(markers);

    if (latlngs.length) {
      map.fitBounds(latlngs, { padding: [30, 30] });
    } else {
      map.setView([20, 0], 2);
    }

    // ====== Clientâ€‘seitige Suche (einfacher Filter) ======
    const searchInput = document.getElementById('search');
    const resetBtn = document.getElementById('reset');

    function applyFilter(term) {
      const q = (term || '').trim().toLowerCase();
      markers.clearLayers();
      const filtered = [];
      AIRPORTS.forEach(ap => {
        const hay = `${ap.name} ${ap.city} ${ap.country} ${ap.iata} ${ap.icao}`.toLowerCase();
        if (!q || hay.includes(q)) filtered.push(ap);
      });
      const newLatLngs = [];
      filtered.forEach(ap => {
        const m = L.marker([ap.lat, ap.lng]);
        const link = ap.makerUrl && ap.makerUrl !== '#' 
          ? `<a href="${ap.makerUrl}" target="_blank" rel="noopener">MakerWorld: Jetzt drucken â†’</a>`
          : `<span class="badge">MakerWorldâ€‘Link folgt</span>`;
        const popup = `
          <div class="popup">
            <h3>${ap.name}</h3>
            <div class="sub">${ap.city}, ${ap.country}</div>
            <div style="margin:.35rem 0 .5rem;">
              <span class="badge">IATA: ${ap.iata}</span>
              <span class="badge">ICAO: ${ap.icao}</span>
            </div>
            ${link}
          </div>`;
        m.bindPopup(popup);
        markers.addLayer(m);
        newLatLngs.push([ap.lat, ap.lng]);
      });
      if (newLatLngs.length) map.fitBounds(newLatLngs, { padding: [30, 30] });
    }

    searchInput.addEventListener('input', (e) => applyFilter(e.target.value));
    resetBtn.addEventListener('click', () => { searchInput.value = ''; applyFilter(''); });

    // ====== QS: offene Links in neuem Tab sichern (bereits im Link gesetzt) ======
  </script>
</body>
</html>
